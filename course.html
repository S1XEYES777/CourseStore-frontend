<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Course Store ‚Äî –ö—É—Ä—Å</title>

    <link rel="stylesheet" href="assets/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body>

<header class="site-header">
    <div class="container navbar">
        <div class="logo">
            <span>CS</span> –ö—É—Ä—Å
        </div>

        <nav class="nav-links">
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="cart.html">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a>
        </nav>
    </div>
</header>

<main class="section">
    <div class="container">

        <div id="courseBlock" class="card" style="padding:22px; border-radius:22px;">
            <h2 class="section-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
        </div>

    </div>
</main>

<footer class="site-footer">
    ¬© 2025 Course Store ‚Äî –£—á–∏—Å—å. –†–∞–∑–≤–∏–≤–∞–π—Å—è. –î–æ—Å—Ç–∏–≥–∞–π.
</footer>

<script src="assets/script.js"></script>

<script>
const API = "https://coursestore-backend.onrender.com";

// ==============================
// üìå –ü–æ–ª—É—á–∞–µ–º ID –∫—É—Ä—Å–∞
// ==============================
const params = new URLSearchParams(window.location.search);
const courseId = params.get("id");
const courseBlock = document.getElementById("courseBlock");

if (!courseId) {
    courseBlock.innerHTML = "<p class='section-subtitle'>–ö—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω.</p>";
}

// ==============================
// üìå –ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–≥–æ –∫—É—Ä—Å–∞
// ==============================
async function loadCourse() {
    try {
        const res = await fetch(`${API}/api/course?course_id=${courseId}`);
        const data = await res.json();

        if (data.status !== "ok") {
            courseBlock.innerHTML = "<p class='section-subtitle'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–∞.</p>";
            return;
        }

        const course = data.course;

        // üî• Base64 image
        const imgSrc = course.image
            ? "data:image/jpeg;base64," + course.image
            : "assets/default.jpg";

        courseBlock.innerHTML = `
            <div style="display:flex; gap:24px; flex-wrap:wrap;">

                <div style="flex:0 0 360px;">
                    <img src="${imgSrc}" style="
                        width:100%;
                        border-radius:18px;
                        border:1px solid rgba(37,99,235,0.4);
                    ">
                </div>

                <div style="flex:1;">
                    <h1 style="font-size:26px; margin-bottom:12px;">${course.title}</h1>

                    <p style="color:#9ca3af; margin-bottom:8px;">
                        –ê–≤—Ç–æ—Ä: <strong style="color:#e5f2ff;">${course.author}</strong>
                    </p>

                    <p style="font-size:20px; font-weight:600; margin-bottom:20px;">
                        ${course.price} ‚Ç∏
                    </p>

                    <button class="btn btn-primary" style="font-size:16px;"
                        onclick="addToCart(${course.id})">
                        –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </div>
            </div>

            <hr style="margin:28px 0; border:0; height:1px; background:#1e293b;">

            <h3 class="section-title">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
            <p style="white-space:pre-line; color:#cbd5e1; margin-top:12px;">
                ${course.description || "–û–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∂–µ."}
            </p>
        `;

    } catch (err) {
        console.error(err);
        courseBlock.innerHTML = "<p class='section-subtitle'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–∞.</p>";
    }
}

loadCourse();

// ==============================
// üõí –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å –≤ –∫–æ—Ä–∑–∏–Ω—É (BACKEND)
// ==============================
async function addToCart(course_id) {
    const user = getUser();
    if (!user) return window.location.href = "login.html";

    try {
        const res = await fetch(`${API}/api/cart/add`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                user_id: user.user_id,
                course_id: course_id
            })
        });

        const data = await res.json();

        if (data.status === "ok") {
            showMessage("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!", "success");
        } else {
            showMessage(data.message || "–û—à–∏–±–∫–∞", "warning");
        }

    } catch (e) {
        showMessage("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞", "error");
    }
}
</script>

</body>
</html>
