<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Admin — CourseStore</title>

    <link rel="stylesheet" href="assets/style.css">
    <script defer src="assets/script.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<section class="auth-page" id="authBlock">
    <div class="auth-card">
        <h2 class="auth-title">Admin Login</h2>

        <div class="form-group">
            <label class="form-label">Логин</label>
            <input id="adminLogin" class="form-input" placeholder="Admin">
        </div>

        <div class="form-group">
            <label class="form-label">Пароль</label>
            <input id="adminPass" class="form-input" type="password" placeholder="123">
        </div>

        <button class="btn-primary btn-block" onclick="adminLogin()">Войти</button>
    </div>
</section>


<!-- ================= ADMIN PANEL ================= -->
<section id="panel" style="display:none; padding:40px 0;">
    <div class="container">

        <h1 style="color:#1A73E8;">Админ Панель</h1>

        <!-- ==== Добавить курс ==== -->
        <div class="card" style="margin-top:20px;">
            <h2>Добавить курс</h2>

            <div class="form-group">
                <label class="form-label">Название</label>
                <input class="form-input" id="course_title">
            </div>

            <div class="form-group">
                <label class="form-label">Цена (₸)</label>
                <input class="form-input" id="course_price" type="number">
            </div>

            <div class="form-group">
                <label class="form-label">Автор</label>
                <input class="form-input" id="course_author">
            </div>

            <div class="form-group">
                <label class="form-label">Описание</label>
                <textarea class="form-input" id="course_desc"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">URL изображения</label>
                <input class="form-input" id="course_img">
            </div>

            <button class="btn-primary" onclick="adminAddCourse()">Добавить курс</button>
        </div>


        <!-- ==== Добавить урок ==== -->
        <div class="card" style="margin-top:20px;">
            <h2>Добавить урок</h2>

            <div class="form-group">
                <label class="form-label">ID курса</label>
                <input class="form-input" id="lesson_course_id">
            </div>

            <div class="form-group">
                <label class="form-label">Название урока</label>
                <input class="form-input" id="lesson_title">
            </div>

            <div class="form-group">
                <label class="form-label">Google Drive ссылка</label>
                <input class="form-input" id="lesson_url" placeholder="https://drive.google.com/.../view">
            </div>

            <div class="form-group">
                <label class="form-label">Позиция (1,2,3...)</label>
                <input class="form-input" id="lesson_position" type="number" value="1">
            </div>

            <button class="btn-primary" onclick="adminAddLesson()">Добавить урок</button>
        </div>


        <!-- ==== Список курсов ==== -->
        <div class="card" style="margin-top:20px;">
            <h2>Все курсы</h2>
            <div id="adminCourseList"></div>
        </div>

    </div>
</section>


<script>
function adminLogin() {
    let login = document.getElementById("adminLogin").value.trim();
    let pass = document.getElementById("adminPass").value.trim();

    if (login === "Admin" && pass === "123") {
        document.getElementById("authBlock").style.display = "none";
        document.getElementById("panel").style.display = "block";
        loadAdminCourses();
    } else {
        showMessage("Неверный логин или пароль", "error");
    }
}


// ==== Загрузить список курсов ====
async function loadAdminCourses() {
    let r = await fetch(API + "/api/courses");
    let data = await r.json();
    let box = document.getElementById("adminCourseList");

    box.innerHTML = "";

    data.courses.forEach(c => {
        let el = document.createElement("div");
        el.className = "admin-course-item";
        el.innerHTML = `
            <div>
                <b>ID:</b> ${c.id}<br>
                <b>${c.title}</b><br>
                Цена: ${c.price} ₸
            </div>
        `;
        box.appendChild(el);
    });
}


// ==== Добавить курс ====
async function adminAddCourse() {
    let title = document.getElementById("course_title").value;
    let price = document.getElementById("course_price").value;
    let author = document.getElementById("course_author").value;
    let desc = document.getElementById("course_desc").value;
    let img = document.getElementById("course_img").value;

    let r = await fetch(API + "/api/courses/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            title, price, author, description: desc, image: img
        })
    });

    showMessage("Курс добавлен", "success");
    loadAdminCourses();
}


// ==== Добавить урок ====
async function adminAddLesson() {
    let course_id = document.getElementById("lesson_course_id").value;
    let title = document.getElementById("lesson_title").value;
    let url = document.getElementById("lesson_url").value;
    let pos = document.getElementById("lesson_position").value;

    let r = await fetch(API + "/api/lessons/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            course_id,
            title,
            youtube_url: url,
            position: pos
        })
    });

    showMessage("Урок добавлен", "success");
}
</script>

</body>
</html>
