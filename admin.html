<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Админ-панель — CourseStore</title>
    <link rel="stylesheet" href="assets/style.css">
</head>

<body data-page="admin">

    <!-- HEADER -->
    <header class="header">
        <div class="header-left">
            <a href="index.html" class="header-logo">
                <img src="assets/logo.png" class="logo-img" alt="">
                <span class="logo-text">CourseStore</span>
            </a>
        </div>

        <nav class="header-nav">
            <a href="index.html">Главная</a>
            <a href="catalog.html">Каталог</a>
            <a href="cart.html">Корзина</a>
            <a href="profile.html">Профиль</a>
        </nav>

        <div class="header-right">
            <div id="user-pill" class="user-pill" style="display:none;">
                <span id="user-pill-name">Admin</span>
                <button onclick="logout()" class="btn-small">Выйти</button>
            </div>
        </div>
    </header>


    <!-- CONTENT -->
    <main class="admin-wrapper">

        <h1 class="admin-title">Админ-панель</h1>

        <!-- TABS -->
        <div class="admin-tabs">
            <button class="admin-tab-btn" data-admin-tab-btn="courses">Курсы</button>
            <button class="admin-tab-btn" data-admin-tab-btn="lessons">Уроки</button>
            <button class="admin-tab-btn" data-admin-tab-btn="users">Пользователи</button>
            <button class="admin-tab-btn" data-admin-tab-btn="reviews">Отзывы</button>
        </div>


        <!-- =========================
             TAB: COURSES
        ========================== -->
        <section class="admin-section" data-admin-tab="courses" style="display:block;">

            <h2>Управление курсами</h2>

            <form id="admin-course-form" class="admin-form">

                <input type="hidden" name="id">

                <label>Название</label>
                <input class="input" type="text" name="title" required>

                <label>Описание</label>
                <textarea class="input" name="description"></textarea>

                <label>Цена</label>
                <input class="input" type="number" name="price" required>

                <label>Обложка курса (URL или загрузка файла)</label>
                <input class="input" type="text" name="thumbnail" placeholder="https://…">

                <label>Загрузить обложку с компьютера</label>
                <input type="file" id="thumb-file" accept="image/*" class="input">

                <button class="btn btn-wide" type="submit">Сохранить курс</button>
                <button id="admin-course-reset" class="btn btn-ghost" type="button">Очистить</button>

            </form>

            <h3>Список курсов</h3>
            <div id="admin-courses-list" class="admin-list"></div>

        </section>


        <!-- =========================
             TAB: LESSONS
        ========================== -->
        <section class="admin-section" data-admin-tab="lessons" style="display:none;">

            <h2>Уроки</h2>

            <label>ID курса</label>
            <input id="admin-lessons-course-id" class="input" type="number" placeholder="Например: 1">

            <button class="btn" onclick="adminLoadLessons()">Показать уроки</button>

            <form id="admin-lesson-form" class="admin-form">

                <label>Название урока</label>
                <input class="input" type="text" name="title">

                <label>Видео URL (YouTube или Google Drive)</label>
                <input class="input" type="text" name="video_url">

                <label>Порядковый номер</label>
                <input class="input" type="number" name="order_index" value="1">

                <button class="btn btn-wide" type="submit">Добавить урок</button>
            </form>

            <h3>Список уроков</h3>
            <div id="admin-lessons-list" class="admin-list"></div>

        </section>



        <!-- =========================
             TAB: USERS
        ========================== -->
        <section class="admin-section" data-admin-tab="users" style="display:none;">
            <h2>Пользователи</h2>
            <div id="admin-users-list" class="admin-list"></div>
        </section>



        <!-- =========================
             TAB: REVIEWS
        ========================== -->
        <section class="admin-section" data-admin-tab="reviews" style="display:none;">
            <h2>Отзывы</h2>
            <div id="admin-reviews-list" class="admin-list"></div>
        </section>

    </main>


    <!-- SCRIPT -->
    <script src="assets/script.js"></script>

    <script>
        // обработка загрузки обложки курса
        document.addEventListener("DOMContentLoaded", () => {
            const thumbInput = document.getElementById("thumb-file");
            const thumbURL = document.querySelector("input[name=thumbnail]");

            if (thumbInput) {
                thumbInput.onchange = async () => {
                    if (!thumbInput.files.length) return;

                    const fd = new FormData();
                    fd.append("file", thumbInput.files[0]);

                    const res = await fetch(API + "/api/upload", {
                        method: "POST",
                        body: fd
                    });

                    const data = await res.json();

                    if (data.status === "ok") {
                        thumbURL.value = data.url;
                        showMessage("Изображение загружено", "success");
                    } else {
                        showMessage("Ошибка загрузки", "error");
                    }
                };
            }
        });
    </script>

</body>
</html>
