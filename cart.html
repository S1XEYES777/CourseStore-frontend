<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Course Store ‚Äî –ö–æ—Ä–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

<header class="site-header">
    <div class="container">
        <div class="navbar">
            <div class="logo">
                <span>CS</span> –ö–æ—Ä–∑–∏–Ω–∞
            </div>
            <nav class="nav-links">
                <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
                <a class="active" href="cart.html">–ö–æ—Ä–∑–∏–Ω–∞</a>
                <a href="profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a>
            </nav>
        </div>
    </div>
</header>

<main class="cart-page">
    <div class="container">

        <section class="cart-card glass-card">
            <h1 style="margin:0 0 12px;">–¢–≤–æ—è –∫–æ—Ä–∑–∏–Ω–∞</h1>
            <p class="balance-note" style="margin-bottom:16px;">
                –ó–¥–µ—Å—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∫—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –≤—ã–±—Ä–∞–ª –¥–ª—è –ø–æ–∫—É–ø–∫–∏.
            </p>

            <div id="cart"></div>
            <div id="cart-footer" style="margin-top:20px;"></div>

        </section>

    </div>
</main>

<footer class="site-footer">
    <div class="container">
        –°–∞–π—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ –∏ –Ω–µ –ø—Ä–µ—Ç–µ–Ω–¥—É–µ—Ç –Ω–∞ –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞.
    </div>
</footer>

<script src="assets/script.js"></script>

<script>
const user = getUser();
if (!user) location.href = "login.html";

/* ============================
   üìå –§—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
============================ */
function getCart() {
    return JSON.parse(localStorage.getItem("cart") || "[]");
}

function saveCart(cart) {
    localStorage.setItem("cart", JSON.stringify(cart));
}

function emptyCartUI() {
    document.getElementById("cart").innerHTML =
        `<p class="balance-note" style="font-size:15px;margin:12px 0;">
            –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞.
         </p>`;
    document.getElementById("cart-footer").innerHTML = "";
}

function loadCart() {
    const cart = getCart();
    const cartBlock = document.getElementById("cart");
    const footer = document.getElementById("cart-footer");

    if (cart.length === 0) return emptyCartUI();

    cartBlock.innerHTML = "";
    let total = 0;

    cart.forEach(item => {
        total += item.price;

        /* ============================
           üî• –ü–†–ê–í–ò–õ–¨–ù–û: –ë–ï–ó API
        ============================ */
        const imgSrc = item.image_url || "assets/default.jpg";

        const card = document.createElement("div");
        card.className = "list-card glass-inner";

        card.innerHTML = `
            <img src="${imgSrc}" style="border-radius:12px; width:180px; height:110px; object-fit:cover;">
            <div class="list-card-main">
                <h3 class="list-card-title">${item.title}</h3>
                <div class="list-description">${(item.description || "").substring(0, 80)}...</div>

                <div class="list-card-meta" style="margin-top:10px;">
                    <span class="price">${item.price} ‚Ç∏</span>
                    <button class="btn btn-danger" style="padding:6px 12px;">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
        `;

        card.querySelector("button").onclick = () => removeItem(item.id);
        cartBlock.appendChild(card);
    });

    footer.innerHTML = `
        <div class="glass-inner" style="
            padding:14px 18px;
            border-radius:16px;
            margin-bottom:12px;
            display:flex;
            justify-content:space-between;
            font-size:16px;
        ">
            <span>–ò—Ç–æ–≥–æ:</span>
            <strong>${total} ‚Ç∏</strong>
        </div>

        <button class="btn btn-primary btn-block" style="padding:12px;font-size:16px;"
                onclick="buy()">
            –û–ø–ª–∞—Ç–∏—Ç—å
        </button>
    `;
}

function removeItem(id) {
    let cart = getCart();
    cart = cart.filter(i => i.id !== id);
    saveCart(cart);
    showMessage("–£–¥–∞–ª–µ–Ω–æ", "success");
    loadCart();
}

/* ============================
   üí≥ –ü–æ–∫—É–ø–∫–∞
============================ */
function buy() {
    const cart = getCart();
    if (cart.length === 0) return;

    user.purchased = user.purchased || [];

    cart.forEach(c => {
        if (!user.purchased.find(p => p.id === c.id)) {
            user.purchased.push(c);
        }
    });

    saveUser(user);

    saveCart([]);
    showMessage("–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞!", "success");

    loadCart();
}

loadCart();
</script>

</body>
</html>
