<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Course Store — Профиль</title>
    <link rel="stylesheet" href="assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header>
    <div class="logo">Профиль</div>
    <nav>
        <a href="catalog.html">Каталог</a>
        <a href="cart.html">Корзина</a>
        <a href="login.html" onclick="logout()">Выход</a>
    </nav>
</header>

<div class="container">
    <div id="profile"></div>
</div>

<script src="assets/script.js"></script>
<script>
const user = getUser();
if (!user) {
    window.location.href = "login.html";
}

async function loadProfile() {
    try {
        const res = await fetch(`${API}/api/user?user_id=${user.user_id}`);
        const data = await res.json();

        if (data.status !== "ok") {
            document.getElementById("profile").innerHTML = "<p>Ошибка загрузки профиля.</p>";
            return;
        }

        const u = data.user;
        const container = document.getElementById("profile");

        container.innerHTML = `
            <div class="profile-card">
                <div class="profile-name">${u.name}</div>
                <div class="profile-line">Телефон: ${u.phone}</div>
                <div class="profile-line">Баланс: ${u.balance} ₸</div>

                <div class="purchases-title">Купленные курсы:</div>
                <div class="purchases-grid">
                    ${
                        (u.purchases && u.purchases.length)
                        ? u.purchases.map(p => `
                            <div class="list-card" style="box-shadow:none;border:1px solid #e5e5ea;">
                                <div class="list-card-main">
                                    <h3 class="list-card-title">${p.title}</h3>
                                </div>
                            </div>
                        `).join("")
                        : "<p>Пока нет купленных курсов.</p>"
                    }
                </div>
            </div>
        `;
    } catch (e) {
        document.getElementById("profile").innerHTML = "<p>Ошибка загрузки профиля.</p>";
        console.error(e);
    }
}

loadProfile();
</script>

</body>
</html>
