<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>CourseStore — Профиль</title>

    <link rel="stylesheet" href="assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

<!-- ================= HEADER ================= -->
<header class="site-header">
    <div class="container navbar">

        <div class="logo">
            <span>CS</span> CourseStore
        </div>

        <nav class="nav-links">
            <a href="index.html">Главная</a>
            <a href="catalog.html">Каталог</a>
            <a href="cart.html">Корзина</a>
            <a href="profile.html" class="active">Профиль</a>
        </nav>

    </div>
</header>


<!-- ================= PROFILE ================= -->
<div class="container">
    <h1 class="section-title">Мой профиль</h1>

    <div class="profile-card">

        <div class="profile-left">
            <img id="p_avatar" class="profile-avatar" src="https://i.imgur.com/ZKLRtYk.png">
        </div>

        <div class="profile-right">
            <h2 id="p_name"></h2>
            <p><b>Телефон:</b> <span id="p_phone"></span></p>
            <p><b>Баланс:</b> <span id="p_balance"></span> ₸</p>

            <button onclick="openTopUp()" class="btn-primary" style="margin-top:10px;">
                Пополнить баланс
            </button>

            <button onclick="logout()" class="btn-danger logout-btn" style="margin-top:10px;">
                Выйти
            </button>
        </div>
    </div>

</div>


<!-- ================= MY COURSES ================= -->
<div class="container">
    <h2 class="section-title">Мои курсы</h2>

    <div id="myCourses" class="catalog">
        <!-- Автозагрузка -->
    </div>
</div>

<!-- ===== Пополнение (модальное окно) ===== -->
<div id="topupModal" style="
    display:none;
    position:fixed;
    left:0; top:0; width:100%; height:100%;
    background:rgba(0,0,0,0.7);
    justify-content:center;
    align-items:center;
">
    <div style="background:white; padding:25px; border-radius:12px; width:320px;">

        <h3 style="margin-top:0;">Пополнить баланс</h3>

        <input id="topupAmount" type="number" placeholder="Сумма" style="
            width:100%; padding:10px; margin-top:10px; border-radius:6px; border:1px solid #bbb;
        ">

        <button onclick="sendTopUp()" style="
            margin-top:15px; width:100%;
            padding:10px; border:none; border-radius:6px;
            background:#007bff; color:white; font-size:16px;
        ">Пополнить</button>

        <button onclick="closeTopUp()" style="
            margin-top:10px; width:100%;
            padding:10px; border:none; border-radius:6px;
            background:#d33; color:white; font-size:16px;
        ">Отмена</button>

    </div>
</div>


<script src="assets/script.js"></script>
<script>
    loadProfile();

    // ===== Модальное окно =====
    function openTopUp() {
        document.getElementById("topupModal").style.display = "flex";
    }
    function closeTopUp() {
        document.getElementById("topupModal").style.display = "none";
    }

    // ===== Отправка пополнения =====
    async function sendTopUp() {
        let amount = +document.getElementById("topupAmount").value;
        let u = getUser();

        if (!amount || amount < 1) {
            showMessage("Введите сумму", "error");
            return;
        }

        await fetch(API + "/api/add-balance", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ user_id: u.user_id, amount })
        });

        showMessage("Баланс пополнен!", "success");
        closeTopUp();
        loadProfile();
    }
</script>

</body>
</html>
