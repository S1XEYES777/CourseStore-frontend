<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Course Store ‚Äî –ö–∞—Ç–∞–ª–æ–≥</title>

    <link rel="stylesheet" href="assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header class="site-header">
    <div class="container navbar">
        <div class="logo">
            <span>CS</span> –ö–∞—Ç–∞–ª–æ–≥
        </div>

        <nav class="nav-links">
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a class="active" href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="cart.html">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a>
        </nav>
    </div>
</header>

<section class="section">
    <div class="container">

        <div class="section-header">
            <h2 class="section-title">–í—Å–µ –∫—É—Ä—Å—ã</h2>
            <p class="section-subtitle">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
        </div>

        <div id="catalog" class="course-grid"></div>

    </div>
</section>

<div class="toast-container"></div>

<script src="assets/script.js"></script>

<script>
const catalogBlock = document.getElementById("catalog");

/* =============================
   üìå –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
============================= */
async function loadCatalog() {
    try {
        const res = await fetch(`${API}/api/courses`);
        const data = await res.json();
        catalogBlock.innerHTML = "";

        if (data.status !== "ok" || !data.courses?.length) {
            catalogBlock.innerHTML = "<p class='section-subtitle'>–ö—É—Ä—Å—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>";
            return;
        }

        data.courses.forEach(course => {

            /* üî• –ü–†–ê–í–ò–õ–¨–ù–û: image_url ‚Äî —ç—Ç–æ –ü–û–õ–ù–ê–Ø –°–°–´–õ–ö–ê */
            const imgSrc = course.image_url || "assets/default.jpg";

            const card = document.createElement("div");
            card.className = "course-card";

            card.innerHTML = `
                <div class="course-thumb">
                    <img src="${imgSrc}" alt="${course.title}">
                </div>

                <div class="course-body">
                    <span class="course-badge">–ù–æ–≤—ã–π –∫—É—Ä—Å</span>

                    <h3 class="course-title">${course.title}</h3>

                    <div class="course-meta">
                        <span>${course.author}</span>
                        <span class="course-price">${course.price} ‚Ç∏</span>
                    </div>
                </div>

                <div class="course-footer">
                    <button class="btn btn-primary btn-small add-btn">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                    <a href="course.html?id=${course.id}" class="btn btn-ghost btn-small">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                </div>
            `;

            // –ö–Ω–æ–ø–∫–∞ "–í –∫–æ—Ä–∑–∏–Ω—É"
            card.querySelector(".add-btn").onclick = () => addToCart(course);

            catalogBlock.appendChild(card);
        });

    } catch (e) {
        console.error(e);
        catalogBlock.innerHTML = "<p class='section-subtitle'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞.</p>";
    }
}

/* =============================
   üõí –ö–æ—Ä–∑–∏–Ω–∞ (localStorage)
============================= */
function getCart() {
    return JSON.parse(localStorage.getItem("cart") || "[]");
}

function saveCart(cart) {
    localStorage.setItem("cart", JSON.stringify(cart));
}

function addToCart(course) {
    const user = getUser();
    if (!user) {
        window.location.href = "login.html";
        return;
    }

    let cart = getCart();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞
    if (!cart.find(item => item.id === course.id)) {
        cart.push({
            id: course.id,
            title: course.title,
            price: course.price,
            description: course.description,
            image_url: course.image_url
        });
        saveCart(cart);
        showMessage("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!", "success");
    } else {
        showMessage("–≠—Ç–æ—Ç –∫—É—Ä—Å —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ!", "warning");
    }
}

loadCatalog();
</script>

</body>
</html>
