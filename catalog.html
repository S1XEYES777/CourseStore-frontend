<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Course Store — Каталог</title>
    <link rel="stylesheet" href="./assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header>
    <div class="logo">Каталог</div>
    <nav>
        <a href="index.html">Главная</a>
        <a href="cart.html">Корзина</a>
        <a href="profile.html">Профиль</a>
    </nav>
</header>

<div class="container">
    <h1 class="section-title">Все курсы</h1>
    <div id="catalog"></div>
</div>

<script src="./assets/script.js"></script>
<script>
const catalogBlock = document.getElementById("catalog");

async function loadCatalog() {
    try {
        const res = await fetch(`${API}/api/courses`);
        const data = await res.json();
        catalogBlock.innerHTML = "";

        if (data.status !== "ok" || !data.courses?.length) {
            catalogBlock.innerHTML = "<p>Курсы пока не добавлены.</p>";
            return;
        }

        data.courses.forEach(c => {
            const imgSrc = c.image_url || "assets/default.jpg";

            const div = document.createElement("div");
            div.className = "list-card";
            div.innerHTML = `
                <img src="${imgSrc}" alt="">
                <div class="list-card-main">
                    <h3 class="list-card-title">${c.title}</h3>
                    <p class="list-card-desc">${(c.description || "").substring(0, 120)}...</p>
                    <div class="list-card-meta">
                        <span class="price">${c.price} ₸</span>
                        <button class="btn btn-primary">Добавить в корзину</button>
                    </div>
                </div>
            `;

            div.querySelector("button").onclick = () => addToCart(c.id);
            catalogBlock.appendChild(div);
        });
    } catch (e) {
        catalogBlock.innerHTML = "<p>Ошибка загрузки каталога.</p>";
        console.error(e);
    }
}

function addToCart(id) {
    const user = getUser();
    if (!user) {
        window.location.href = "login.html";
        return;
    }

    fetch(`${API}/api/cart/add`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ user_id: user.user_id, course_id: id })
    })
    .then(r => r.json())
    .then(d => {
        if (d.status === "ok") showMessage("Добавлено в корзину!");
        else showMessage(d.message || "Не удалось добавить в корзину");
    })
    .catch(() => showMessage("Ошибка соединения с сервером"));
}

loadCatalog();
</script>

</body>
</html>



