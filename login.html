<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Course Store ‚Äî –í—Ö–æ–¥</title>

    <link rel="stylesheet" href="assets/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

<!-- ================= HEADER ================= -->
<header class="site-header">
    <div class="container navbar">
        <div class="logo">
            <span>CS</span> Course Store
        </div>

        <nav class="nav-links">
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="login.html" class="active">–í—Ö–æ–¥</a>
        </nav>
    </div>
</header>


<!-- ================= AUTH PAGE ================= -->
<main class="auth-page">

    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å üëã</h1>
            <p class="auth-subtitle">–í–æ–π–¥–∏ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å–∞–º.</p>
        </div>

        <!-- Tabs -->
        <div class="auth-tabs">
            <button id="tab-login" class="auth-tab active">–í—Ö–æ–¥</button>
            <button id="tab-register" class="auth-tab">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>

        <!-- ========== LOGIN FORM ========== -->
        <div id="login-form">
            <div class="form-group">
                <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input id="loginPhone" class="form-input" type="text" placeholder="+7..." />
            </div>

            <div class="form-group">
                <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                <input id="loginPass" class="form-input" type="password" placeholder="–ü–∞—Ä–æ–ª—å" />
            </div>

            <button class="btn btn-primary btn-block" onclick="login()">–í–æ–π—Ç–∏</button>

            <p class="auth-footnote">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ù–∞–∂–º–∏ ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª</p>
        </div>

        <!-- ========== REGISTER FORM ========== -->
        <div id="register-form" style="display:none;">
            <div class="form-group">
                <label class="form-label">–ò–º—è</label>
                <input id="regName" class="form-input" type="text" placeholder="–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?" />
            </div>

            <div class="form-group">
                <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input id="regPhone" class="form-input" type="text" placeholder="+7..." />
            </div>

            <div class="form-group">
                <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                <input id="regPass" class="form-input" type="password" placeholder="–ü—Ä–∏–¥—É–º–∞–π –ø–∞—Ä–æ–ª—å" />
            </div>

            <button class="btn btn-primary btn-block" onclick="registerUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>

            <p class="auth-footnote">–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –≤–æ–π–¥—ë—à—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
        </div>

    </div>

</main>


<!-- ================= FOOTER ================= -->
<footer class="site-footer">
    ¬© 2025 Course Store ‚Äî –ø—Ä–æ–µ–∫—Ç –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞.
</footer>


<script src="assets/script.js"></script>

<script>
// ==========================
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
// ==========================
const tabLogin = document.getElementById("tab-login");
const tabRegister = document.getElementById("tab-register");
const loginForm = document.getElementById("login-form");
const registerForm = document.getElementById("register-form");

tabLogin.onclick = () => {
    tabLogin.classList.add("active");
    tabRegister.classList.remove("active");
    loginForm.style.display = "";
    registerForm.style.display = "none";
};

tabRegister.onclick = () => {
    tabRegister.classList.add("active");
    tabLogin.classList.remove("active");
    loginForm.style.display = "none";
    registerForm.style.display = "";
};

// –£–∂–µ –≤–æ—à—ë–ª ‚Üí –≤ –∫–∞—Ç–∞–ª–æ–≥
if (getUser()) {
    window.location.href = "catalog.html";
}


// ==========================
// –í—Ö–æ–¥
// ==========================
async function login() {
    const phone = loginPhone.value.trim();
    const pass = loginPass.value.trim();

    if (!phone || !pass) {
        showMessage("–ó–∞–ø–æ–ª–Ω–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–∞—Ä–æ–ª—å", "warning");
        return;
    }

    try {
        const data = await apiPost("/api/login", { phone, password: pass });

        if (!data.user) throw new Error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞");

        saveUser(data.user);

        showMessage("–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!", "success");
        setTimeout(() => window.location.href = "catalog.html", 300);

    } catch (err) {
        showMessage(err.message, "error");
    }
}


// ==========================
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
// ==========================
async function registerUser() {
    const name = regName.value.trim();
    const phone = regPhone.value.trim();
    const pass = regPass.value.trim();

    if (!name || !phone || !pass) {
        showMessage("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è", "warning");
        return;
    }

    try {
        // –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await apiPost("/api/register", {
            name, phone, password: pass
        });

        showMessage("–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è! –í—Ö–æ–¥–∏–º...", "success");

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        const data = await apiPost("/api/login", {
            phone,
            password: pass
        });

        saveUser(data.user);

        setTimeout(() => {
            window.location.href = "catalog.html";
        }, 300);

    } catch (err) {
        showMessage(err.message, "error");
    }
}
</script>

</body>
</html>
